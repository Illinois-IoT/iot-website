{"componentChunkName":"component---src-templates-camp-curriculum-js","path":"/camp/day4","result":{"data":{"markdownRemark":{"html":"<h2>Introduction</h2>\n<h3>a) What is a Web Server?</h3>\n<p>In a nutshell, a web server is both the hardware and software required to create a website that you can access via the Internet.</p>\n<p>For example, if you go to <code class=\"language-text\">amazon.com</code>, a request is made from your computer to a server owned by Amazon. The returned result is what you see on your screen. If you want to access any piece of data/information through the Internet, that data/information must be stored somewhere and there must be some sort of software to help you access it.</p>\n<p>On the hardware side, a web server is a computer that stores web server software and a website's component files (for example, HTML documents, images, CSS stylesheets, and JavaScript files). A web server connects to the internet and supports physical data interchange with other devices connected to the web.</p>\n<p>On the software side, a web server includes several parts that control how web users access hosted files.</p>\n<h3>b) How Does Your Browser Know What to Show?</h3>\n<p>This is where HTTP requests come in. HTTP (Hypertext Transfer Protocol) is a protocol (or set of rules) that specifies how hypertext (linked web documents) are transferred to and from the web server.</p>\n<p>At the most basic level, whenever a browser needs a file that is hosted on a web server, the browser requests the file via HTTP. When the request reaches the correct (hardware) web server, the (software) HTTP server accepts the request, finds the requested document, and sends it back to the browser, also through HTTP.</p>\n<p><img src=\"/static/day4_http-10ae4004af3bbeccac9a9e1d51ff107f.svg\" alt=\"\"></p>\n<p>What are some examples of requests made from a browser to a web server?</p>\n<ol>\n<li>\n<p>when you type in <code class=\"language-text\">amazon.com</code>, a request is made for the contents of the main page. The response are files (HTML/CSS, etc.) that specify to the browser how and what to display.</p>\n</li>\n<li>\n<p>every query (or question) you type into <code class=\"language-text\">Google</code> is a request made to the Google servers. The request includes your query string. Your browser will then receive back a response that consists of a list of relevant links.</p>\n</li>\n<li>\n<p>every video you watch on <code class=\"language-text\">YouTube</code> requires HTTP requests. Your browser requests the video from YouTube's servers and once it is received, you can view it on your screen.</p>\n</li>\n</ol>\n<p><img src=\"/static/day4_http_get-0559b8fdaf341c2f82009d81d2117191.png\" alt=\"\"></p>\n<h3>c) Types of HTTP Requests</h3>\n<p>Now that we know how our browser can receive data from any web server, how do we contribute to the web?</p>\n<p>Every day, over 95 million photos and videos are shared on Instagram. There are also 720,000 hours of video being uploaded to YouTube on the daily basis. Let's look at the technical mechanics of how these pieces of media are posted onto the internet for everyone to see.</p>\n<p>Above, we discussed how your browser loads data. They do it by <code class=\"language-text\">GET</code>ting data from a web server. Now, when you want to post a new Instagram post, your browser will need to <code class=\"language-text\">POST</code> to the web server. What about when you want to edit a caption? Well, that's a <code class=\"language-text\">PUT</code> request. And when you decide that your post is no longer relevant, you can <code class=\"language-text\">DELETE</code> from the web server.</p>\n<p>Let's summarize. Here are the most common HTTP requests. There are others like <code class=\"language-text\">PATCH</code> or <code class=\"language-text\">OPTIONS</code>, but we will not cover them here.</p>\n<h4>GET</h4>\n<p>The HTTP <code class=\"language-text\">GET</code> method is used to <strong>read</strong> (or retrieve) a representation of a resource. <code class=\"language-text\">GET</code> requests are only for reading data, and not changing it.</p>\n<h4>POST</h4>\n<p>The <code class=\"language-text\">POST</code> verb is most often utilized to <strong>create</strong> new resources.</p>\n<h4>PUT</h4>\n<p><code class=\"language-text\">PUT</code> is most often utilized for <strong>update</strong> capabilities, PUT-ing to a known resource URI with the request body containing the newly-updated representation of the original resource.</p>\n<h4>DELETE</h4>\n<p><code class=\"language-text\">DELETE</code> is pretty easy to understand. It is used to <strong>delete</strong> a resource identified by a URI.</p>\n<h3>d) Putting it All Together</h3>\n<p>Here is an example of an HTTP request:</p>\n<p><img src=\"/static/day4_http_request_format-5ada73e4b5d1063d8777a899fd084cdc.png\" alt=\"\"></p>\n<p>It starts with a <strong>method</strong> (a verb we learned about above), followed by the path to the resource to fetch. An example of a path is <code class=\"language-text\">google.com</code> or <code class=\"language-text\">instagram.com/illinoiscs</code>. Then, we will specify the version of the HTTP protocol we want to use (don't worry about this for now). And finally, any optional headers we want to send to the server are included.</p>\n<p>Next, here is an example of a response from the server:</p>\n<p><img src=\"/static/day4_http_response_format-9792bf91f728c308bbeb362cf32937b5.png\" alt=\"\"></p>\n<p>We will not go into details about the response format, but feel free to do some extra reading on your own!</p>\n<p>The only thing is note is the <code class=\"language-text\">Content-Type</code>. The server can respond with a myriad of different data types, including <code class=\"language-text\">text/html</code> for textual results, <code class=\"language-text\">image/jpeg</code> for images, <code class=\"language-text\">video/mp4</code> for videos.</p>\n<h3>e) All About Flask</h3>\n<p>Now that we know about how web servers work, let's discuss how we can create one ourselves using Python.</p>\n<p>Flask is a web framework in Python. This means flask provides you with tools, libraries and technologies that allow you to build a web application. This web application can be some web pages, a blog, a wiki or go as big as a web-based calendar application or a commercial website.</p>\n<p>We will start by writing a <code class=\"language-text\">\"Hello World\"</code> application in Flask.</p>\n<p>To begin, we will need to create a new folder to store our web application.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> -p hello_flask/<span class=\"token punctuation\">{</span>templates,static<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This will create the following structure. The <code class=\"language-text\">hello_fask/</code> folder is the root folder of our web app and there are 2 subfolders inside.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">hello_flask/\r\n<span class=\"token operator\">|</span>-- static\r\n<span class=\"token operator\">|</span>-- templates</code></pre></div>\n<p>The <code class=\"language-text\">templates/</code> folder is the place where the templates will be put. The <code class=\"language-text\">static/</code> folder is the place where any files (images, css, javascript) needed by the web application will be put. These two folders define what the front end of the web app will look like.</p>\n<p>Now, inside of <code class=\"language-text\">hello_fask/</code> we will create the server file. This is the \"backend\" of our app. Think of the backend as where all of the HTTP requests are processed and what response is sent back.</p>\n<p>Create a <code class=\"language-text\">main.py</code> inside of <code class=\"language-text\">hello_flask/</code>.</p>\n<p>Inside of <code class=\"language-text\">main.py</code>, we will first need to import flask. Then, we create the application.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber 0\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> flask\r\n<span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> Flask\r\n\r\napp <span class=\"token operator\">=</span> Flask<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\r\n    app<span class=\"token punctuation\">.</span>debug<span class=\"token operator\">=</span><span class=\"token boolean\">True</span>\r\n    app<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Perfect. Now you have a flask app! But as you've probably already guessed, our app doesn't do anything. We need to create accessible routes. Put this code before the if statement.</p>\n<div class=\"gatsby-highlight\" data-language=\"pythonv\"><pre class=\"language-pythonv\"><code class=\"language-pythonv\">@app.route(&#39;/&#39;)\r\ndef index():\r\n    &quot;&quot;&quot; Displays the index page accessible at &#39;/&#39;\r\n    &quot;&quot;&quot;\r\n    return flask.render_template(&#39;index.html&#39;)</code></pre></div>\n<p>What this method does is whenever someone goes to the uri <code class=\"language-text\">/</code>, it will render <code class=\"language-text\">index.html</code>.</p>\n<p>App routing means mapping the urls to a specific function that will handle the logic for that url. For example, in our Python code, we defined the route <code class=\"language-text\">/</code> for the method called <code class=\"language-text\">index()</code>. This means whenever someone goes to <code class=\"language-text\">www.example.com/</code>, the function <code class=\"language-text\">index()</code> is run and whatever is the <code class=\"language-text\">return</code> of that method also gets returned to the browser.</p>\n<p>Similarly, if you defined the route <code class=\"language-text\">/hello</code> for a method called <code class=\"language-text\">hello_func</code>, then whenever someone accesses <code class=\"language-text\">www.example.com/hello</code>, the <code class=\"language-text\">hello_func</code> is called.</p>\n<p>Now, let's create a simple <code class=\"language-text\">index.html</code> that displays <code class=\"language-text\">\"Hello World\"</code>. Inside of <code class=\"language-text\">templates/</code>, create a new file called <code class=\"language-text\">index.html</code>.</p>\n<p>Inside, let's put</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber 0\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>en<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Hello world!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\r\n\r\nIt works!\r\n\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now we can run our web app!</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python3 main.py</code></pre></div>\n<p>Now in your browser, navigate to <code class=\"language-text\">http://127.0.0.1:5000/</code> and you should see the following</p>\n<p><img src=\"/static/day4_hello_flask_Index-8fdb8ee4201c1a976f88849738c51bec.png\" alt=\"\"></p>\n<h3>f) A Little Bit on IP Addresses and Ports</h3>\n<p>Now you might be wondering why the url we typed in is a series of numbers. This has to do with IP. IP stands for \"Internet Protocol,\" which is the set of rules governing the format of data sent via the internet or local network. In essence, IP addresses are the identifier that allows information to be sent between devices on a network: they contain location information and make devices accessible for communication.</p>\n<p>Every device has its own IP address. You can find the IP address of your Raspberry Pi by running <code class=\"language-text\">ifconfig</code> in the terminal. In the printout, find <code class=\"language-text\">etho0</code> and the numbers after <code class=\"language-text\">inet address</code> is your IP address!</p>\n<p><img src=\"/static/day4_ip_address_pi-e1dc08ee3472aacce1e63fb3a349e196.png\" alt=\"\"></p>\n<p>IP addresses are very useful. If I wanted to access a file on your computer, I would first need to know your IP address (and then get to hacking). If I wanted to send you a file, I would also need to know your IP address so that the file is sent to the right device.</p>\n<p>There is a lot to know when it comes to IP addresses, and since it is simply a protocol (a set of rules), the protocol can change. There are currently two forms of IP address: IPv4 and IPv6. There is no need to know much about them, but the main differences are defined below.</p>\n<p><img src=\"/static/day4_ipv4_ipv6-0e299b957ee945fcbba82e5dd41bbdee.webp\" alt=\"\"></p>\n<p>When the internet was first created, IPv4 was sufficient in identifying all devices on the network. But as the internet grew, we soon realized that there is not enough unique identifiers! So IPV6 was introduced so that each device can have its own unique address.</p>\n<p>For now, we will stick with IPv4 address, which is a string of 4 numbers (between 0 and 255) separated by periods. So, the full IP addressing range goes from 0.0.0.0 to 255.255.255.255.</p>\n<p>There is one special address you should remember that is <code class=\"language-text\">127.0.0.1</code>. This is known as your localhost (or home). You might have even seen memes online like this:</p>\n<p><img src=\"/static/day4_home_meme-5889befb212e4bb503112ae6a2b18bb3.webp\" alt=\"\"></p>\n<p>and now you know what it means! When you ran the flask server, you can access it locally (on the same computer) by going to <code class=\"language-text\">http://127.0.0.1</code>. Try going to the same address on your phone and you'll find that there is nothing there.</p>\n<p>That is because to access a server on the same network, you must go to its IP address. So for example, if I run the flask server on my Raspberry Pi which has an IP address of <code class=\"language-text\">192.168.0.108</code>, I can go on my phone (that's connected to the same Wi-Fi network) and type in <code class=\"language-text\">http://192.168.0.108:5000</code> to see the web app you just created.</p>\n<h3>g) Where Did the <code class=\"language-text\">:5000</code> Come From?</h3>\n<p>As you have noticed, you cannot simply go to <code class=\"language-text\">http://192.168.0.108</code> to access the web app. You have to go to <code class=\"language-text\">http://192.168.0.108:5000</code>. This is because your web app is run on port 5000.</p>\n<p>Not only do you have to know a server's IP address, you also have to know which port the server is run on.</p>\n<p>Imagine you want to run two web apps at the same time on the same machine. How do you do that? If you go to <code class=\"language-text\">http://192.168.0.108</code>, which web page should be shown? That is why we need ports. By default flask servers are run on port 5000 (but you can change that if you want). If you tried running a different web app at the same time, you will need to specify a different port number (lets say 5001). Then, to access the first webpage, you can go to <code class=\"language-text\">http://192.168.0.108:5000</code> and to access the second, you can go to <code class=\"language-text\">http://192.168.0.108:5001</code>.</p>\n<p>Phew we're finally done with the introduction. Lets move on to creating a web app for your smart doorbell system!</p>\n<h2>Who's At the Door?</h2>\n<p>In reality, a smart doorbell is not very smart if you don't know who is there. That's why today we will create a web app that allows you to stream the camera feed from another device!</p>\n<p>By the end of today, you will be able to open your phone and see what your camera sees.</p>\n<p>Let's get started.</p>\n<h3>a) Setting up Flask</h3>\n<p>Like before, we need to create a new project folder. Lets call it <code class=\"language-text\">camera_streamer/</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> -p camera_streamer/<span class=\"token punctuation\">{</span>templates,static<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This should create the following directory structure:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">camera_streamer/\r\n<span class=\"token operator\">|</span>-- static\r\n<span class=\"token operator\">|</span>-- templates</code></pre></div>\n<p>Now, let's create the server file. Inside the <code class=\"language-text\">camera_streamer/</code> folder, create a new file called <code class=\"language-text\">main.py</code>.</p>\n<p>Inside, we will use the following starter code:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber 0\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> flask\r\n<span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> Flask<span class=\"token punctuation\">,</span> render_template<span class=\"token punctuation\">,</span> Response\r\n\r\napp <span class=\"token operator\">=</span> Flask<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'index.html'</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\r\n    app<span class=\"token punctuation\">.</span>debug<span class=\"token operator\">=</span><span class=\"token boolean\">False</span>\r\n    app<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then, create <code class=\"language-text\">index.html</code> inside of <code class=\"language-text\">templates/</code> with the following code:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber 0\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>en<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\r\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Hello world!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3>b) Creating the UI</h3>\n<p>Next, let's create the main web page with a placeholder for the video feed.</p>\n<p>Navigate to <code class=\"language-text\">index.html</code>.</p>\n<p>Inside the <code class=\"language-text\">&lt;body>&lt;/body></code> tags, add the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>main<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>newpost<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>camera-bg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ url_for(<span class=\"token punctuation\">'</span>video_feed<span class=\"token punctuation\">'</span>) }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Here, we are creating a <code class=\"language-text\">div</code>. In HTML, <code class=\"language-text\">div</code>s are divisions or sections, and is mainly used to create containers for other elements.</p>\n<p>Inside this division, we are creating an <code class=\"language-text\">img</code> (image) element. We need to specify a <code class=\"language-text\">src</code> (or source) for this image. The <code class=\"language-text\">src</code> is how the browser knows where to look for the image before its able to display it.</p>\n<p>The source of the image we want to display is dynamically set. In flask, we can use <code class=\"language-text\">url_for</code> to specify a route that will supply the image. Here, that route is <code class=\"language-text\">/video_feed</code>.</p>\n<h3>c) A New Route</h3>\n<p>In <code class=\"language-text\">index.html</code>, we specified the route <code class=\"language-text\">/video_feed</code>. Now we must add functionality to this route on the backend.</p>\n<p>Open <code class=\"language-text\">main.py</code>.</p>\n<p>Inside, we will add a new method for this route.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/video_feed'</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">video_feed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">None</span></code></pre></div>\n<p>To get the video feed, we first need to setup the camera (like we did before).</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber 0\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> picamera<span class=\"token punctuation\">.</span>array <span class=\"token keyword\">import</span> PiRGBArray\r\n<span class=\"token keyword\">from</span> picamera <span class=\"token keyword\">import</span> PiCamera\r\n\r\ncamera <span class=\"token operator\">=</span> PiCamera<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\ncamera<span class=\"token punctuation\">.</span>resolution <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">640</span><span class=\"token punctuation\">,</span> <span class=\"token number\">480</span><span class=\"token punctuation\">)</span>\r\nraw_capture <span class=\"token operator\">=</span> PiRGBArray<span class=\"token punctuation\">(</span>camera<span class=\"token punctuation\">,</span> size<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">640</span><span class=\"token punctuation\">,</span> <span class=\"token number\">480</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now, lets create a helper function to get the frame. This is also exactly what we have done before. Don't forget to import cv2.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber 0\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">get_camera_frames</span><span class=\"token punctuation\">(</span>camera<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">for</span> frame <span class=\"token keyword\">in</span> camera<span class=\"token punctuation\">.</span>capture_continuous<span class=\"token punctuation\">(</span>raw_capture<span class=\"token punctuation\">,</span> <span class=\"token builtin\">format</span><span class=\"token operator\">=</span><span class=\"token string\">\"bgr\"</span><span class=\"token punctuation\">,</span> use_video_port<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        image <span class=\"token operator\">=</span> frame<span class=\"token punctuation\">.</span>array\r\n        raw_capture<span class=\"token punctuation\">.</span>truncate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n        raw_capture<span class=\"token punctuation\">.</span>seek<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n        _<span class=\"token punctuation\">,</span> image <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imencode<span class=\"token punctuation\">(</span><span class=\"token string\">\".jpg\"</span><span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">)</span>\r\n        <span class=\"token keyword\">yield</span> <span class=\"token punctuation\">(</span><span class=\"token string\">b'--frame\\r\\n'</span>\r\n               <span class=\"token string\">b'Content-Type: image/jpeg\\r\\n\\r\\n'</span> <span class=\"token operator\">+</span> image<span class=\"token punctuation\">.</span>tobytes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">b'\\r\\n\\r\\n'</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here, we loop through all of the frames in a continuous capture feed. Then, we must convert the frame to bytes. To do so, we must first use <code class=\"language-text\">OpenCV</code> to encode it into a jpg using <code class=\"language-text\">cv2.imencode</code>. Next, we will convert it into bytes using the <code class=\"language-text\">tobytes()</code> function.</p>\n<p>Finally, we want to send the frame as an image in the response. Remember that when we learned about HTTP requests and responses, the response can be on various types. To send an image response back to the end, we will define the <code class=\"language-text\">Content-Type</code> to be <code class=\"language-text\">image/jpeg</code>.</p>\n<p>Now that we have a helper function that returns each frame, let's go back to <code class=\"language-text\">video_feed()</code>. Here, we want to have flask help us respond to the request. Flask has a <code class=\"language-text\">Response()</code> method for this reason. Without having to worry too much about what this built-in function does, we will use it in <code class=\"language-text\">video_feed</code> to return a constant stream of image frames to the client.</p>\n<p>The final <code class=\"language-text\">video_feed()</code> function should look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/video_feed'</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">video_feed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>get_camera_frames<span class=\"token punctuation\">(</span>camera<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n                    mimetype<span class=\"token operator\">=</span><span class=\"token string\">'multipart/x-mixed-replace; boundary=frame'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>And that's it! You have just created a web app using Flask that streams the feed of the camera attached to your Raspberry Pi. To execute this, go to the terminal and run</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python3 main.py</code></pre></div>\n<h3>7/22 edit</h3>\n<p>Before you are able to serve your website and have it available on another device, you have to change the <code class=\"language-text\">main</code> function to the following</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\r\n    app<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span>host<span class=\"token operator\">=</span><span class=\"token string\">'0.0.0.0'</span><span class=\"token punctuation\">,</span> debug<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Do a quick Google search and answer for yourself why you have to add this!</p>\n<p>Now, if you visit <code class=\"language-text\">http://127.0.0.1:5000</code> on your Raspberry Pi, you should see a real-time stream of your camera!</p>\n<p>To access this page from your phone, you will need the IP address of your Raspbery Pi (revisit how to do so above). Make sure your phone is on the same Wi-Fi network as your Raspberry Pi. Then all you need to do is visit <code class=\"language-text\">http://&lt;Raspberry Pi's IP>:5000</code> on your device!</p>","frontmatter":{"date":"June 22, 2023","slug":"/camp/day4","title":"Day 4"}}},"pageContext":{"slug":"/camp/day4"}},"staticQueryHashes":[]}