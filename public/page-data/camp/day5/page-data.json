{
    "componentChunkName": "component---src-templates-camp-curriculum-js",
    "path": "/camp/day5",
    "result": {"data":{"markdownRemark":{"html":"<h2>Introduction</h2>\n<p>Today, we will continue our journey of implementing a smart doorbell. We're going to make the doorbell listen to the visitors and transcribe what they are saying. In addition, we will integrate our code for motion detection from day3 into our video feed.</p>\n<p>Before doing so, we need a bit more knowledge about web development.</p>\n<h3>More on web development</h3>\n<h4>a) Front-end and back-end</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e4d6c5e358a2de7db0c5ea7e82d8610e/4c868/day5_front-end_VS_back-end.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.68711656441718%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAADeklEQVQ4y2WTa0xbZRjHjyiXCaG0EJQpUQcZi0hHS9vTc9rTC6WlPe0Kcr+UtdFMk4mioIhZHJnbjGxcHIMYsrgQlW2M6RS2sUyTgWbGmCX6ySA4L9uMiV+M+sFv/sxpN1zYh1/e9+Sc5/ee5//kFdwGJ848CXuuFUlnW0fOFVEMMi8be3lLPMib5oO8vn0PvkIP1iwzYqYFW2YVYlZqlXJsuA0KgpInE9ocILatg87SNjpL24lt7aCttAWlQOZ48F2Wdy6x3LjEWfUj/IXVjHWMMPPi+3zQ8x7Hnplitvckr3h6Ee+3IFhyTBywv8HPjT+yumuF1adWuNaxxtfhr4iUqLzjm+RS50Uu1i9yWp3Fn+/j+5nvuHHhOtfOrrF6ZoU/v/iDU30zVN5bgSDn2ohvjTGmjDDsPcSwd4hR9zAHxH1UF3kYloY4/+QCF8LnOKZM4cv3cHnoM344vcrSyGU+f3uZ3xZuMhE/gjljO4KWoSPPjphnQcy1IOosyb1NV0VNYTW9VT3scQ3Q7+pjQOpH3VxL6MEALSWNNDxSR8Oj9TRvaSBQ6EPRywguvQNN6jEod5PvTErdBg9ythOP3ou3QMGhsyeHJuvE1KoNUC8nPYLLkBJuRJOJmyS6xBomXmthMFFHTzSMLVNKSjcertVoPye49ZrA8T+3nj0FTqwZEt3BIOemu5g72sahFxow3aMJU8Xr39926J13CG+/2CB8KRrh/HScE6NtDCaimNNSwvVu7qhxacL1DPPvRslz4HtAQX3MQ7PRx45SL45cOdXyRvKVWy1rN0UnI2ZL2HPkJGKOjJQjJYWBIi/h4hrUh3zJvcvgRMyyYtVuSlYKa0YVUraYGopWFHrYy05jkK5yP12P+4hX+GkpCxAu9jLZ3sB+NcLeQISpWBOtJS7Gd7/KpaPjzB8eZv7wCJ9OTjAQSWDbZEMwZ0qMN0XhVD3/nojBbBxm2/h9bAcJc4R+d4iqTJEn0mx0SypPlyv88uUS/LMG15fhxhXgJvOj4xgFI4LWXrc9yMJzUc7sbuLD7lY+6W7keEeYhCnC3POdTMXbOdLeysd9CZ41+bg6dxJ+usLf3y7y1zeL8OtVpgcGMaWZUhlquRnTJSrT7VSmi1Rm2Km4TyJW7mdfKMpgqI69wXr2q1F2mWtRi300b1NpLEvRVKZSW+RJZv4fanNGrupWMmQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"day5 front end VS back end\"\n        title=\"day5 front end VS back end\"\n        src=\"/static/e4d6c5e358a2de7db0c5ea7e82d8610e/b2a6d/day5_front-end_VS_back-end.png\"\n        srcset=\"/static/e4d6c5e358a2de7db0c5ea7e82d8610e/9f4d0/day5_front-end_VS_back-end.png 163w,\n/static/e4d6c5e358a2de7db0c5ea7e82d8610e/06d7c/day5_front-end_VS_back-end.png 325w,\n/static/e4d6c5e358a2de7db0c5ea7e82d8610e/b2a6d/day5_front-end_VS_back-end.png 650w,\n/static/e4d6c5e358a2de7db0c5ea7e82d8610e/b0417/day5_front-end_VS_back-end.png 975w,\n/static/e4d6c5e358a2de7db0c5ea7e82d8610e/c8d79/day5_front-end_VS_back-end.png 1300w,\n/static/e4d6c5e358a2de7db0c5ea7e82d8610e/4c868/day5_front-end_VS_back-end.png 1596w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Websites usually consist of two parts: the front-end and the back-end. The front-end is the side that users experience. It is responsible for how a page looks, responds, and appears when a user opens up a website and interacts with the elements on the page. HTML, CSS, and JavaScript are the building blocks of front-end development. They can be rendered, presented, and executed on every browser and ensure the browsing experience for 1 billion websites and 5 billion users.</p>\n<p>On the contrary, the back-end is the guts of the web application, containing inner logic and structures and living on the server. The back-end stores, processes, and serves program and user data to ensure that the front-end has what it needs. For our project, we were mainly working on the back-end, i.e. the logic to capture camera frames and create a video feed. In addition to Python, back-end developers use programming languages like Java, PHP, and Ruby to work with data.</p>\n<p>However, the front-end of our project is so far very simple - we don't have interactive elements like buttons but only an image that doesn't fit the size of the screen well. So today, we will make our website look nicer while adding interactions and more functionalities to it.</p>\n<h4>b) The basics of CSS</h4>\n<p>Yesterday, we created two HTML documents. HTML is a <em>markup language</em> that tells web browsers the structure and content of the web pages. These documents will be readable in a browser. They are, however, very ugly and of basic style by default. For a better look, we need to design the style and layout of the elements. We could do so by adding <code class=\"language-text\">style</code> attribute to HTML tags, for example,</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>camera-bg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ url_for(<span class=\"token punctuation\">'</span>video_feed<span class=\"token punctuation\">'</span>) }}<span class=\"token punctuation\">\"</span></span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span> <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>would fill our camera frame to the entire page. However, adding <code class=\"language-text\">style</code> attribute to every HTML tag is often tedious and will make the HTML file long and messy. Moreover, oftentimes we want not only to style one single element but also to make a group or class of elements having the same style.</p>\n<p>This is where CSS (Cascading Style Sheets) becomes handy. CSS is designed to style and lay out web pages. You can use it to alter the font, color, size, and spacing of your content, split it into multiple columns, or even add animations. CSS is rule-based â€” you define the rules by specifying groups of styles that should be applied to particular elements or groups of elements on your web page.</p>\n<p>For example, you can decide to have the main heading on your page to be shown as large red text. The following code shows a very simple CSS rule that would achieve the styling described above:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">h1</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> red<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> 5em<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>In the above example, the CSS rule opens with a <strong>selector</strong>. This selects the HTML element that we are going to style. In this case, we are styling level one headings (<code class=\"language-text\">&lt;h1></code>).</li>\n<li>We then have a set of curly braces <code class=\"language-text\">{ }</code>.</li>\n<li>Inside the braces will be one or more declarations, which take the form of <strong>property</strong> and <strong>value</strong> pairs. We specify the property (<code class=\"language-text\">color</code> in the above example) before the colon, and we specify the value of the property after the colon (<code class=\"language-text\">red</code> in this example).</li>\n<li>This example contains two declarations, one for <code class=\"language-text\">color</code> and the other for <code class=\"language-text\">font-size</code>. Each pair specifies a property of the element(s) we are selecting (<code class=\"language-text\">&lt;h1></code> in this case), then a value that we'd like to give the property.</li>\n</ul>\n<p>CSS properties have different allowable values, depending on which property is being specified. In our example, we have the <code class=\"language-text\">color</code> property, which can take various color values. We also have the <code class=\"language-text\">font-size</code> property. This property can take various size units as a value. You can find links to all the CSS property pages (along with other CSS features) listed on the MDN <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/Reference\">CSS reference</a>.</p>\n<p>CSS selectors are designed to select HTML elements in a flexible way. In the example above, we used a basic selector that directly matches all the elements by their tag name (<code class=\"language-text\">&lt;h1></code>). We can also target multiple selectors at the same time by separating the selectors with a comma. If you want all paragraphs and all list items to be green, your rule would look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">p, li</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> green<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Instead of using a comma, you may also put a space between two selectors. This is called the <strong>descendant combinator,</strong> which selects an element following a hierarchy. For example, to select an <code class=\"language-text\">&lt;em></code> that is nested inside an <code class=\"language-text\">&lt;li></code> element,</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">li em</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> rebeccapurple<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We also need some ways more specific than general tag names. One option is to use <code class=\"language-text\">#id</code> selector that links to a unique element, say the element with <code class=\"language-text\">id=\"firstname\"</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">#firstname</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> yellow<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can also select elements of a certain class by creating a selector that starts with a full stop character. For instance, to target the class of <code class=\"language-text\">special</code> you could do:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.special</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> orange<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> bold<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Sometimes you will see rules with a selector that lists the HTML element selector along with the class:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">li.special</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> orange<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> bold<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This syntax means \"target any <code class=\"language-text\">li</code> element that has a class of <code class=\"language-text\">special</code>\".</p>\n<p>Finally, CSS has the ability to style things based on their state. The CSS below styles unvisited links pink and visited links green.</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">a:link</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> pink<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">a:visited</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> green<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You may notice we listed two CSS rules at the same time. This formed a simple CSS stylesheet. A CSS stylesheet in real-life will contain many such rules, written one after the other.</p>\n<p>There are three different ways to apply CSS rules to an HTML document that you may come across, however, for this tutorial, we will look at the most usual and useful way of doing so â€” linking CSS stylesheets from the head of your document.</p>\n<p>The first thing you need to do is to save the CSS stylesheet you created to a CSS file, say <code class=\"language-text\">style.css</code>. To link <code class=\"language-text\">styles.css</code> to a HTML document, add the following line somewhere inside the <code class=\"language-text\">&lt;head></code> of the HTML document:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>This <code class=\"language-text\">&lt;link></code> element tells the browser that we have a stylesheet, using the <code class=\"language-text\">rel</code> attribute, and the location of that stylesheet as the value of the <code class=\"language-text\">href</code> attribute. You can link multiple stylesheets and they will influence the document's style in a \"cascading\" way:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style1.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style2.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h4>c) A little bit on JavaScript</h4>\n<p>Now weâ€™ve learned marking up content as HTML documents and using CSS to style them. However, HTML and CSS are both declarative languages specifying how to display content. They are static and cannot react to usersâ€™ actions. So how can we handle usersâ€™ input and dynamically change the pageâ€™s content based on available data? The answer is  JavaScript, a programming language that browsers understand and that controls the interactivity on the page.</p>\n<p>JavaScript is versatile yet beginner-friendly. Being a scripting language, itâ€™s similar to Python to some extent. We will cover only a little bit of the language, just so you can understand the code we will use today.</p>\n<p>In JavaScript, you declare a variable with the <code class=\"language-text\">let</code> keyword, followed by the name you give to the variable:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> myVariable<span class=\"token punctuation\">;</span></code></pre></div>\n<p>A semicolon at the end of a line indicates where a statement ends. Like Python, you can assign a value or expression to the variable when declaring it:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> myVariable <span class=\"token operator\">=</span> <span class=\"token string\">'Bob'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Declaring a function is also similar to Python. Instead of <code class=\"language-text\">def</code>, you use <code class=\"language-text\">function</code>. And you use curly braces rather than a colon and indentations:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num1<span class=\"token punctuation\">,</span>num2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> num1 <span class=\"token operator\">*</span> num2<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>There are four basic data types in JavaScript: string, number, boolean, and array. They are self-explanatory. Other than these, everything in JavaScript is an object, which can be seen as a collection of properties and functions. You can access the properties or functions by the form <code class=\"language-text\">objectName.propertyName</code>or <code class=\"language-text\">objectName.functionName</code>. For example, <code class=\"language-text\">document</code> is a very important object that represents the whole HTML document youâ€™re visiting. It consists of a bunch of properties, such as <code class=\"language-text\">document.lastModified</code> which is the date on which the document was last modified. It also has a variety of functions (called methods.) One of the most useful ones is <code class=\"language-text\">document.getElementById()</code> which returns the element of a certain id on the page. Through <code class=\"language-text\">document</code> object, JavaScript enables interactivity for the webpage.</p>\n<p>To use JavaScript, you enter this code on a new line, just before the closing <code class=\"language-text\">&lt;/body></code> tag in the HTML document:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>scriptname.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>This is doing the same job as the <code class=\"language-text\">&lt;link></code> element for CSS. It applies the JavaScript to the page, so it can have an effect on the HTML.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/26c5995e9b730cc9843dd68c231944c1/d01ea/day5_html_css_js_im1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.68711656441718%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAD/klEQVQ4y3WTWUzTBwDG/49Ltuxt04dlh1mCVwYkG1myMdC5TcUDRrahiLJ5TIguCGLxCIMBBZTLMYkDxpRDjrIhKlSOnrSUS46qXDp1ElAKVmlr+y//lt8CWTJf9nv6vu/hy/fyCbyAdwHmJQ+Sx/tfthj+izg2jFN9HVe3EVenHtGoRVzUBi1iTyeiSY/QrOqkTa2l1XCTNoOZjt4RWo1mCqtaKKpV0aQbRNU9xtQTB+6+ThwmA65eE88NWhxG3ZK36zU4ekzY1a0INX9cwWKxcLZSx4PJ2aUlA2MTyM7VM/7wEaJ7HpvDiemOFUtfLxPZydzLTGamqQFrXzdWUwfWnk6sPSasXQaENn0XV9v0HD17hfIyBY1l5WQrVGSVN6EdGOdP9Q1U3aOoBv6mrv02f/WbwTPP/yFsOnKJ1FI1GVXdJB06TdTBArbKagk73kBo8nX2nNaQXGlGrhinRj/B7YfPeGKXmJqxY7E6cIkSolvCI3lgwYvwzudprIk4T1hiA0mxhUQWjhJfcZ/TVydJb3xEbvM0jQM2Zh0eYAGPNM9zlxunW8Jmd/LU5sL23M2cw43N6UVY+2kivuuO8dGGJLZtOcnKb2vZm2ugsd/K4BSMT0vcs7h4aJUYm5YYnPTSfV9CN+ZGObJA64gXzR1oGYZLxjkEn7VhbPtwJ2EfR/NBiByfqDreDC1mzZ5qInN6KDPOUdXvJbPFRWqTyLEGJ3Gl9/jl5AVii8zsP6PhYEYjX8XmkFpQj1CQkkWwTzDhARGsCDzMxkgZXyQ24bOjnJW7KvD7/jL7Su8TXzZOfG4zKfl1pORVsOuzLez082X9tkg+CdrMqtXvUVLRjIB1Bo0sjo2BX/PSikBeX76M9TsS8I26iN835/CLKsF/XzVxJ85QrVBSVd/Ob5XN+AeGEP1+AKdiZcSlXyD958vIi1oQnrUreZafhllRR8z2cPZv3k5o6G78v0zhrU1neXdTFqvC8jmQkE1JtY684mtkFzWSmq+gsLKT9jOllNeaiEurJCYhB8HV34vN1AF3R1gYNsPkA+SncvANiuCN4BMs35hH0IEScn5XkfFrKwlZtew9WsjOmAxCok+xdf12TgYHUVyuYOKRBUG8NYRoHsB5cwh7f99S8fnia2zeEEbE6gCCVq0jZvcRDv8g57vIQ9T8mEHFT5mclx0n/2AMdbm5TFVfgMEeuDuKMD9yC3dvF6JBhzg6DHNWEvYn8Oprb7PslZfJlB2jXi6nJikRZVI8aJQwehOG+sB8A4aHcBt12FuVuBavN9tlYNagZdagY6bLgGOgl7rSYkJCw5Fn5yAtvPAr21Om2pQ81ql4rFPzWK9hWq/Gom1npkPLYtc/M+uLowMaX7AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"day5 html css js im1\"\n        title=\"day5 html css js im1\"\n        src=\"/static/26c5995e9b730cc9843dd68c231944c1/b2a6d/day5_html_css_js_im1.png\"\n        srcset=\"/static/26c5995e9b730cc9843dd68c231944c1/9f4d0/day5_html_css_js_im1.png 163w,\n/static/26c5995e9b730cc9843dd68c231944c1/06d7c/day5_html_css_js_im1.png 325w,\n/static/26c5995e9b730cc9843dd68c231944c1/b2a6d/day5_html_css_js_im1.png 650w,\n/static/26c5995e9b730cc9843dd68c231944c1/b0417/day5_html_css_js_im1.png 975w,\n/static/26c5995e9b730cc9843dd68c231944c1/c8d79/day5_html_css_js_im1.png 1300w,\n/static/26c5995e9b730cc9843dd68c231944c1/d01ea/day5_html_css_js_im1.png 1488w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f47242da16fd90c5d26b04d362518074/09ada/day5_html_css_js_im2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.68711656441718%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACAElEQVQ4y32Ti26iQBSGff/X2U02u2nLtjZNtzW9WgUr3qqAositIDD4bWYa79Y/ORk4c+Y/98pyuUQiXeTMghQvzPCjlJVentsiUS4hTAR+VJBkXzrUPVTk9yIr8EJBvdHm8vKGySzBj3OOoShKnt86PD3rPD7WqT006PadtXNFaI0DGnqHu7sHrq//8VrX0d8/iJKcLBfKoZQsL3DnCS/1Fn+1KzStyvmZRr3ZIxdfka4JL7Qqf36fU63ecnam8fhi0LdDnGmM5UbYbsxoEiqdZbto2hUXF1cqCMeNSdJ8QzgPF/SHLobRRtfbDD5sJl6KEOVBykG0YGh5vDUMGm8GhtFh6ATkhdgQytxHYx/DHNLp2+imwzxIjzRFaRg4Ae2ug9HqM7A8os9sU8NV51Sns5I0E4RxxsAODggl8qKkZ/l8pjlxkqv/ld1OhNvEErJ203nyNSbl5l5GFyXZju32iFVOzVtv5K9ro+oXL1Rjtp3sv69850lC1kbvuujvA1rmCL07pRAl32W1TnkfK8OpnzKy5/z88UuNlD0JmYfpjs0B4X6qK0M50HK+arVnNWu3tzXu758YzxKOvVmn/B2h3IyJl9BovqsVe3lt0tRNxrPP04ScgFyzwWiKbpiKuDd01RKcQkUIwb4URbE+rbGP2bMxew6uFyNEsWOzL/8BUDiBRl8pRHEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"day5 html css js im2\"\n        title=\"day5 html css js im2\"\n        src=\"/static/f47242da16fd90c5d26b04d362518074/b2a6d/day5_html_css_js_im2.png\"\n        srcset=\"/static/f47242da16fd90c5d26b04d362518074/9f4d0/day5_html_css_js_im2.png 163w,\n/static/f47242da16fd90c5d26b04d362518074/06d7c/day5_html_css_js_im2.png 325w,\n/static/f47242da16fd90c5d26b04d362518074/b2a6d/day5_html_css_js_im2.png 650w,\n/static/f47242da16fd90c5d26b04d362518074/b0417/day5_html_css_js_im2.png 975w,\n/static/f47242da16fd90c5d26b04d362518074/c8d79/day5_html_css_js_im2.png 1300w,\n/static/f47242da16fd90c5d26b04d362518074/09ada/day5_html_css_js_im2.png 1582w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>\"Listening\" to your visitors</h2>\n<p>A doorbell can't be smart if the visitors can't speak to us. To fix this, we can easily implement audio live streaming using an HTML audio control just like how we streamed video. However, we like challenging ourselves and want our doorbell to be even smarter - it will recognize what they say and show us the transcript.</p>\n<p>Sounds complicated? It's actually much easier than you thought, so let's get started.</p>\n<h3>Adding a navigation bar</h3>\n<h4>Extending the HTML</h4>\n<p>We will first extend <code class=\"language-text\">index.html</code> in our <code class=\"language-text\">camera_streamer</code> project to support a navigation bar at the bottom where we can add a button and show some subtitles. We want to use the button to trigger audio recording and recognizing and use the subtitle to show transcription result.</p>\n<p>To do so, letâ€™s add a new <code class=\"language-text\">&lt;div></code> element to the <code class=\"language-text\">&lt;body></code>, with a <code class=\"language-text\">&lt;button></code> and a <code class=\"language-text\">&lt;span></code> of text in it:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber 0\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>navbar<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>recordButton<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fa fa-microphone fa-2x<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>subtitle<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4>Tweaking the styles</h4>\n<p>In its current form, our <code class=\"language-text\">navbar</code> doesnâ€™t remotely resemble a navigation bar that we see on other websites. We will use CSS to make it look fancier. Besides, we will make sure the camera feed scales correctly and fits into our screen.</p>\n<p>To do so, letâ€™s create a <code class=\"language-text\">style.css</code> file in the <code class=\"language-text\">static</code> folder and enter the following lines of code:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre style=\"counter-reset: linenumber 0\" class=\"language-css line-numbers\"><code class=\"language-css\"><span class=\"token selector\">.navbar</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> fixed<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">bottom</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> auto<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> black<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 0.6<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> white<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.navbar i</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> white<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> red<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">i.fa</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> inline-block<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 60px<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">box-shadow</span><span class=\"token punctuation\">:</span> 0px 0px 2px #888<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 0.5em 0.6em<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">button</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> transparent<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-repeat</span><span class=\"token punctuation\">:</span> no-repeat<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span> pointer<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">outline</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.camera-bg</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> dimgray<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> fixed<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">object-fit</span><span class=\"token punctuation\">:</span> contain<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Donâ€™t worry if you donâ€™t understand the meaning of a particular property. You just need to go through it and see which elements the rules are targeting.</p>\n<p>Now letâ€™s save it and link it to the HTML file:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ url_for(<span class=\"token punctuation\">'</span>static<span class=\"token punctuation\">'</span>, filename=<span class=\"token punctuation\">'</span>style.css<span class=\"token punctuation\">'</span>) }}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>We will also link another online CSS stylesheet, <code class=\"language-text\">font-awesome</code>, which provides us with some useful icons we can use in our button:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>In fact, the class names we specified above, <code class=\"language-text\">fa fa-microphone fa-2x</code>,  refer to some rules defined in this stylesheet.</p>\n<p>Our HTMLâ€™s <code class=\"language-text\">&lt;head></code> now looks like the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber 0\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Hello world!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ url_for(<span class=\"token punctuation\">'</span>static<span class=\"token punctuation\">'</span>, filename=<span class=\"token punctuation\">'</span>style.css<span class=\"token punctuation\">'</span>) }}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4>Defining the interactions</h4>\n<p>Now we have a pretty navigation bar. Itâ€™s time to define how the button and subtitle behave.\nCreate a new file called \"helper.js\" in your static folder.</p>\n<p>First, we get these elements in JavaScript:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 0\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> recordButton <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"recordButton\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> recordButtonIcon <span class=\"token operator\">=</span> recordButton<span class=\"token punctuation\">.</span>firstElementChild<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> subtitle <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"subtitle\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>In the second line,  <code class=\"language-text\">recordButton.firstElementChild</code> finds the <code class=\"language-text\">&lt;i></code> element inside the button, which is used to display the icon. We select this element because we want to change the buttonâ€™s icon during recording.</p>\n<p>Next, letâ€™s add an event listener to the button:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">recordButton<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> startListening<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This means whenever a user clicks the button, the function <code class=\"language-text\">startListening</code> will be called, so we can react to the click using this function. We havenâ€™t defined it yet, and letâ€™s do it now.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 0\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">startListening</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//replace the microphone icon with a circle icon</span>\n    recordButtonIcon<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fa-microphone\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fa-circle\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//disable the button to prevent misclick</span>\n    recordButton<span class=\"token punctuation\">.</span>disabled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//set subtile to \"listening...\"</span>\n    subtitle<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">\"Listening...\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//create a new GET request</span>\n    <span class=\"token keyword\">let</span> xhr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"listen\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//call processResult when the result is ready</span>\n    xhr<span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span> processResult<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//send the request to /listen</span>\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>We will also need to define the callback function <code class=\"language-text\">processResult</code> so that after our doorbell responded to our GET request and recognized a phrase, we would show the transcription in the subtitle:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 0\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">processResult</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//set the subtitle to the returned result</span>\n    subtitle<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">\"Result: \"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>responseText<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//show the microphone icon again</span>\n    recordButtonIcon<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fa-circle\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fa-microphone\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//re-enable the button</span>\n    recordButton<span class=\"token punctuation\">.</span>disabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Thatâ€™s it! Letâ€™s save it as <code class=\"language-text\">helper.js</code> in the <code class=\"language-text\">static</code> folder and link it to the HTML:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ url_for(<span class=\"token punctuation\">'</span>static<span class=\"token punctuation\">'</span>, filename=<span class=\"token punctuation\">'</span>helper.js<span class=\"token punctuation\">'</span>) }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>So our final <code class=\"language-text\">index.html</code> will look like</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber 0\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Hello world!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ url_for(<span class=\"token punctuation\">'</span>static<span class=\"token punctuation\">'</span>, filename=<span class=\"token punctuation\">'</span>style.css<span class=\"token punctuation\">'</span>) }}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>main<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>newpost<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>camera-bg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ url_for(<span class=\"token punctuation\">'</span>video_feed<span class=\"token punctuation\">'</span>) }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>navbar<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>recordButton<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fa fa-microphone fa-2x<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>subtitle<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{ url_for(<span class=\"token punctuation\">'</span>static<span class=\"token punctuation\">'</span>, filename=<span class=\"token punctuation\">'</span>helper.js<span class=\"token punctuation\">'</span>) }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3>Speech recognition in Python</h3>\n<p>Letâ€™s move on to the back-end part. <code class=\"language-text\">SpeechRecognition</code> is a powerful Python library for performing speech recognition. In just a few lines, we will be able to detect a phrase and transcribe it.</p>\n<p>As always, we first need to import the library:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> speech_recognition <span class=\"token keyword\">as</span> sr</code></pre></div>\n<p>Then we will initialize a <code class=\"language-text\">Recognizer</code> and a <code class=\"language-text\">Microphone</code>. We should use the <code class=\"language-text\">Microphone</code> instance as our audio source and calibrate it before we start listening:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber 0\" class=\"language-python line-numbers\"><code class=\"language-python\">recognizer <span class=\"token operator\">=</span> sr<span class=\"token punctuation\">.</span>Recognizer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nmic <span class=\"token operator\">=</span> sr<span class=\"token punctuation\">.</span>Microphone<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">with</span> mic <span class=\"token keyword\">as</span> source<span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># we only need to calibrate once, before we start listening</span>\n    recognizer<span class=\"token punctuation\">.</span>adjust_for_ambient_noise<span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now, let's create a new function for transcribing audio captured by the microphone:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber 0\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">transcribe_audio</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> mic <span class=\"token keyword\">as</span> source<span class=\"token punctuation\">:</span>\n        audio <span class=\"token operator\">=</span> recognizer<span class=\"token punctuation\">.</span>listen<span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> recognizer<span class=\"token punctuation\">.</span>recognize_google<span class=\"token punctuation\">(</span>audio<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span> sr<span class=\"token punctuation\">.</span>UnknownValueError<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"Google Speech Recognition could not understand audio\"</span>\n    <span class=\"token keyword\">except</span> sr<span class=\"token punctuation\">.</span>RequestError <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"Could not request results from Google Speech Recognition service; {0}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The essential part is</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">with</span> mic <span class=\"token keyword\">as</span> source<span class=\"token punctuation\">:</span>\n    audio <span class=\"token operator\">=</span> recognizer<span class=\"token punctuation\">.</span>listen<span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> recognizer<span class=\"token punctuation\">.</span>recognize_google<span class=\"token punctuation\">(</span>audio<span class=\"token punctuation\">)</span></code></pre></div>\n<p>The rest is just for error handling (and no need to worry about.)</p>\n<p>Note that <code class=\"language-text\">SpeechRecognition</code> supports several engines and APIs, such as Microsoft Bing Voice Recognition and CMU's Sphinx. In our case, we are using Google Speech Recognition API. You can find examples for using other engines here: <a href=\"https://github.com/Uberi/speech_recognition/blob/master/examples/microphone_recognition.py\">https://github.com/Uberi/speech_recognition/blob/master/examples/microphone_recognition.py</a>.</p>\n<p>Copy these lines to a new Python script, run it locally, and see how it goes. Assuming it works well, now it's time to add them to <code class=\"language-text\">main.py</code> in the <code class=\"language-text\">camera_streamer</code> project we worked on. Make sure the import statement appears in the same place as other import statements, the initialization code goes right after other initializations, and the <code class=\"language-text\">transcribe_audio</code> function follows other functions.</p>\n<p>We also need to add a new route to <code class=\"language-text\">transcribe_audio</code>, so our server can respond to the GET request sent by the JavaScript:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/listen'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">transcribe_audio</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>There we go! Go to the terminal and run</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python3 main.py</code></pre></div>\n<p>Visit the webpage the same way you did yesterday. You should notice the difference between styles and layout and be able to try the speech recognition feature by clicking the microphone button.</p>\n<h2>Detecting motion</h2>\n<p>Finally, letâ€™s incorporate our code for motion detection into our back-end. After this, we will be able to see motion alerts remotely on our video feed!</p>\n<p>To do so, letâ€™s copy the code from day3 and add a new function to <code class=\"language-text\">main.py</code>. But we have to add one more line this time: <code class=\"language-text\">global reference_frame</code>. This is just a trick to tell Python to use a global <code class=\"language-text\">reference_frame</code> variable instead of a local one.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber 0\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">detect_motion</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">global</span> reference_frame\n    min_area <span class=\"token operator\">=</span> <span class=\"token number\">15</span>\n    maybe_motion_text <span class=\"token operator\">=</span> <span class=\"token string\">\"Not Detected\"</span>\n\n    current_frame <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2GRAY<span class=\"token punctuation\">)</span>\n    current_frame <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>GaussianBlur<span class=\"token punctuation\">(</span>current_frame<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">21</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> reference_frame <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n        reference_frame <span class=\"token operator\">=</span> current_frame\n\n    frame_delta <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>absdiff<span class=\"token punctuation\">(</span>reference_frame<span class=\"token punctuation\">,</span> current_frame<span class=\"token punctuation\">)</span>\n    thresh <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>threshold<span class=\"token punctuation\">(</span>frame_delta<span class=\"token punctuation\">,</span> <span class=\"token number\">25</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>THRESH_BINARY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\n    thresh <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>dilate<span class=\"token punctuation\">(</span>thresh<span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> iterations<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    cnts <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>findContours<span class=\"token punctuation\">(</span>thresh<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>RETR_EXTERNAL<span class=\"token punctuation\">,</span>\n                            cv2<span class=\"token punctuation\">.</span>CHAIN_APPROX_SIMPLE<span class=\"token punctuation\">)</span>\n    cnts <span class=\"token operator\">=</span> imutils<span class=\"token punctuation\">.</span>grab_contours<span class=\"token punctuation\">(</span>cnts<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">for</span> c <span class=\"token keyword\">in</span> cnts<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> cv2<span class=\"token punctuation\">.</span>contourArea<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> min_area<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">continue</span>\n        <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>boundingRect<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span>\n        cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n        maybe_motion_text <span class=\"token operator\">=</span> <span class=\"token string\">\"Detected\"</span>\n\n    cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Motion: {}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>maybe_motion_text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>FONT_HERSHEY_SIMPLEX<span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> datetime<span class=\"token punctuation\">.</span>datetime<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strftime<span class=\"token punctuation\">(</span><span class=\"token string\">\"%A %d %B %Y %I: %M: %S%p\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>FONT_HERSHEY_SIMPLEX<span class=\"token punctuation\">,</span> <span class=\"token number\">0.35</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> image</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Also, we need to define the global variable for our reference frame (put it before the App Global):</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">reference_frame <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span></code></pre></div>\n<p>Now the only thing we need to do is to call the <code class=\"language-text\">detect_motion</code> function right after <code class=\"language-text\">raw_capture.seek(0)</code> in <code class=\"language-text\">get_camera_frames()</code>.</p>\n<p>For reference, the final <code class=\"language-text\">main.py</code> should look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber 0\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> flask\n<span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> Flask<span class=\"token punctuation\">,</span> render_template<span class=\"token punctuation\">,</span> Response<span class=\"token punctuation\">,</span> request\n<span class=\"token keyword\">from</span> picamera<span class=\"token punctuation\">.</span>array <span class=\"token keyword\">import</span> PiRGBArray\n<span class=\"token keyword\">from</span> picamera <span class=\"token keyword\">import</span> PiCamera\n<span class=\"token keyword\">import</span> datetime\n<span class=\"token keyword\">import</span> imutils\n<span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> speech_recognition <span class=\"token keyword\">as</span> sr\n\ncamera <span class=\"token operator\">=</span> PiCamera<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ncamera<span class=\"token punctuation\">.</span>resolution <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">640</span><span class=\"token punctuation\">,</span> <span class=\"token number\">480</span><span class=\"token punctuation\">)</span>\nraw_capture <span class=\"token operator\">=</span> PiRGBArray<span class=\"token punctuation\">(</span>camera<span class=\"token punctuation\">,</span> size<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">640</span><span class=\"token punctuation\">,</span> <span class=\"token number\">480</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nrecognizer <span class=\"token operator\">=</span> sr<span class=\"token punctuation\">.</span>Recognizer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nmic <span class=\"token operator\">=</span> sr<span class=\"token punctuation\">.</span>Microphone<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">with</span> mic <span class=\"token keyword\">as</span> source<span class=\"token punctuation\">:</span>\n    recognizer<span class=\"token punctuation\">.</span>adjust_for_ambient_noise<span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span>\n\nreference_frame <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n\n<span class=\"token comment\"># App Global (do not edit)</span>\napp <span class=\"token operator\">=</span> Flask<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'index.html'</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">detect_motion</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">global</span> reference_frame\n    min_area <span class=\"token operator\">=</span> <span class=\"token number\">15</span>\n    maybe_motion_text <span class=\"token operator\">=</span> <span class=\"token string\">\"Not Detected\"</span>\n\n    current_frame <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2GRAY<span class=\"token punctuation\">)</span>\n    current_frame <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>GaussianBlur<span class=\"token punctuation\">(</span>current_frame<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">21</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> reference_frame <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n        reference_frame <span class=\"token operator\">=</span> current_frame\n\n    frame_delta <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>absdiff<span class=\"token punctuation\">(</span>reference_frame<span class=\"token punctuation\">,</span> current_frame<span class=\"token punctuation\">)</span>\n    thresh <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>threshold<span class=\"token punctuation\">(</span>frame_delta<span class=\"token punctuation\">,</span> <span class=\"token number\">25</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>THRESH_BINARY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\n    thresh <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>dilate<span class=\"token punctuation\">(</span>thresh<span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> iterations<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    cnts <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>findContours<span class=\"token punctuation\">(</span>thresh<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>RETR_EXTERNAL<span class=\"token punctuation\">,</span>\n                            cv2<span class=\"token punctuation\">.</span>CHAIN_APPROX_SIMPLE<span class=\"token punctuation\">)</span>\n    cnts <span class=\"token operator\">=</span> imutils<span class=\"token punctuation\">.</span>grab_contours<span class=\"token punctuation\">(</span>cnts<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">for</span> c <span class=\"token keyword\">in</span> cnts<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> cv2<span class=\"token punctuation\">.</span>contourArea<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> min_area<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">continue</span>\n        <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>boundingRect<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span>\n        cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">,</span> y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n        maybe_motion_text <span class=\"token operator\">=</span> <span class=\"token string\">\"Detected\"</span>\n\n    cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Motion: {}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>maybe_motion_text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>FONT_HERSHEY_SIMPLEX<span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    cv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> datetime<span class=\"token punctuation\">.</span>datetime<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strftime<span class=\"token punctuation\">(</span><span class=\"token string\">\"%A %d %B %Y %I: %M: %S%p\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>FONT_HERSHEY_SIMPLEX<span class=\"token punctuation\">,</span> <span class=\"token number\">0.35</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> image\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_camera_frames</span><span class=\"token punctuation\">(</span>camera<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> frame <span class=\"token keyword\">in</span> camera<span class=\"token punctuation\">.</span>capture_continuous<span class=\"token punctuation\">(</span>raw_capture<span class=\"token punctuation\">,</span> <span class=\"token builtin\">format</span><span class=\"token operator\">=</span><span class=\"token string\">\"bgr\"</span><span class=\"token punctuation\">,</span> use_video_port<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        image <span class=\"token operator\">=</span> frame<span class=\"token punctuation\">.</span>array\n        raw_capture<span class=\"token punctuation\">.</span>truncate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        raw_capture<span class=\"token punctuation\">.</span>seek<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n        image <span class=\"token operator\">=</span> detect_motion<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span>\n\n        _<span class=\"token punctuation\">,</span> image <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imencode<span class=\"token punctuation\">(</span><span class=\"token string\">\".jpg\"</span><span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">yield</span> <span class=\"token punctuation\">(</span><span class=\"token string\">b'--frame\\r\\n'</span>\n               <span class=\"token string\">b'Content-Type: image/jpeg\\r\\n\\r\\n'</span> <span class=\"token operator\">+</span> image<span class=\"token punctuation\">.</span>tobytes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">b'\\r\\n\\r\\n'</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/video_feed'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">video_feed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>get_camera_frames<span class=\"token punctuation\">(</span>camera<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    mimetype<span class=\"token operator\">=</span><span class=\"token string\">'multipart/x-mixed-replace; boundary=frame'</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/listen'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">transcribe_audio</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> mic <span class=\"token keyword\">as</span> source<span class=\"token punctuation\">:</span>\n        audio <span class=\"token operator\">=</span> recognizer<span class=\"token punctuation\">.</span>listen<span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> recognizer<span class=\"token punctuation\">.</span>recognize_google<span class=\"token punctuation\">(</span>audio<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span> sr<span class=\"token punctuation\">.</span>UnknownValueError<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"Google Speech Recognition could not understand audio\"</span>\n    <span class=\"token keyword\">except</span> sr<span class=\"token punctuation\">.</span>RequestError <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"Could not request results from Google Speech Recognition service; {0}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    app<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span>host<span class=\"token operator\">=</span><span class=\"token string\">'0.0.0.0'</span><span class=\"token punctuation\">,</span> debug<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","frontmatter":{"date":"June 24, 2022","slug":"/camp/day5","title":"Day 5"}}},"pageContext":{"slug":"/camp/day5"}},
    "staticQueryHashes": []}